---
import { base } from "astro:config/server";

import ThemeButton from "./ThemeButton.tsx";
import BackgroundPatternButton from "./BackgroundPatternButton.tsx";

import Logo from "../images/logo.svg";

const nav = [
  { name: "Posts", href: "/posts" },
  { name: "Projects", href: "/projects" },
  { name: "Tags", href: "/tags" },
];

// Normalize function to strip base, trim slashes, and lowercase
const normalize = (path: string) =>
  path.replace(base, "").replace(/\/+$/, "").toLowerCase() || "/";

// Normalize current path
const currentPath = normalize(Astro.url.pathname);

// Utility to check if nav item is active
const isActive = (href: string) => normalize(href) === currentPath;
---

<header
  role="banner"
  aria-label="Site Header"
  class="w-full px-6 py-4 bg-transparent text-foreground sticky top-0 z-50 backdrop-blur-lg"
>
  <div class="max-w-7xl mx-auto flex items-center justify-between gap-4">
    <!-- Logo / Site Title -->
    <a href="/" class="hover:text-primary transition-colors">
      <Logo id="main-logo" class="w-16 h-16 md:w-10 md:h-10" />
    </a>

    <!-- Center Nav Links -->
    <nav aria-label="Main Navigation">
      <ul class="flex gap-6 text-sm font-medium list-none">
        {
          nav.map((item) => (
            <li>
              <a
                href={item.href}
                class={`hover:text-primary transition-colors ${
                  isActive(item.href)
                    ? "text-primary underline underline-offset-4"
                    : ""
                }`}
                aria-current={isActive(item.href) ? "page" : undefined}
              >
                {item.name}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>

    <!-- Button Group: Theme + Background -->
    <div class="flex gap-1 border border-grid overflow-hidden">
      <!-- Theme Toggle -->
      <ThemeButton client:load />
      <BackgroundPatternButton client:load />
    </div>
  </div>
</header>
